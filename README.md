# ChatFleet Frontend (v0.1.1)

Minimalist Next.js 15 interface for the ChatFleet multi-RAG platform. This UI aligns with the v0.1.1 FastAPI backend, shared Zod schemas (`/schemas/index.ts`), and Pact contracts. It preserves the assistant-ui experience while enforcing typed API access, SSE streaming, and JWT auth.

## Quickstart

```bash
cp .env.example .env.local # ensure NEXT_PUBLIC_API_BASE + heartbeat vars
npm install
npm run dev
```

Environment variables consumed by the frontend:

| Key | Purpose | Default |
| --- | --- | --- |
| `NEXT_PUBLIC_API_BASE` | Backend base URL with `/api` prefix | `http://localhost:8000/api` |
| `NEXT_PUBLIC_SSE_HEARTBEAT_MS` | Expected SSE heartbeat for `/chat/stream` | `15000` |

Sign in via `/login`, seeded admin users receive the admin console (`/admin`). JWT tokens persist in `localStorage` (`chatfleet.auth.token`) and refresh on load via `/auth/me`.

## Development Workflow

- **API client**: `lib/apiClient.ts` (`@generated by codex.chatfleet`) wraps OpenAPI endpoints with shared Zod schemas. Extend this file if the backend adds routes.
- **Streaming chat**: `lib/chat/stream.ts` validates SSE events (`ready → chunk* → citations → done → ping`). Consumers should never bypass Zod parsing.
- **Auth state**: `components/providers/auth-provider.tsx` manages login/register flows and exposes `useAuth`. Guard new routes by checking `user.role`.
- **Styling**: Tailwind + shadcn UI. Keep class lists unsorted—Prettier with the Tailwind plugin handles ordering.

## Testing & Validation

- `npm run lint` — Next.js + ESLint.
- Contract tests: scaffold lives in `/tests/contract` (Pact consumer/provider). Fill in provider verification once the backend is reachable.
- Manual smoke checklist before every PR:
  1. `/login` → authenticate → redirected to `/`.
  2. `/rag/{slug}` → send prompt → observe SSE chunks, citations appended, corr_id + usage badge.
  3. Admin (`/admin` & `/admin/rag/{slug}`) → upload stub PDF → confirm `job_id`, user invites, revoke access.
  4. Refresh page → JWT rehydration via `/auth/me`.

Known gaps / follow-ups:

1. Wire `/rag/rebuild` + `/rag/reset` actions into the admin surface with optimistic UI.
2. Persist chat threads and citations to `/chat` history; surface transcripts in the sidebar.
3. Integrate pact consumer tests into CI and add provider verification job using FastAPI container.
4. Add loading/error states for `/jobs/{id}` polling to track upload progress after initiation.
